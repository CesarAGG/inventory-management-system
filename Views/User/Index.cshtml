@model InventoryManagementSystem.ViewModels.UserPageViewModel

@{
    ViewData["Title"] = "My Page";
}

<h1>@ViewData["Title"]</h1>
<p class="text-muted">A central place to manage your inventories.</p>
<hr />

<div class="card mb-4">
    <div class="card-header">
        <h4 class="mb-0">Inventories I Own</h4>
    </div>
    <div class="card-body">
        <table id="ownedInventoriesTable" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Created At</th>
                    <th>Item Count</th>
                    <th>Access</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h4 class="mb-0">Inventories Shared With Me</h4>
    </div>
    <div class="card-body">
        <table id="sharedInventoriesTable" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Created At</th>
                    <th>Item Count</th>
                    <th>Owner</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="~/js/inventory/common.js" asp-append-version="true"></script>
    <script>
        $(document).ready(function () {
            const commonDataTablesOptions = {
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "type": "POST",
                    "dataType": "json",
                    "error": function (xhr, error, thrown) {
                        showToast('An error occurred while loading data. Please try again.', true);
                    }
                }
            };

            $('#ownedInventoriesTable').DataTable({
                ...commonDataTablesOptions,
                "ajax": {
                    ...commonDataTablesOptions.ajax,
                    "url": "@Url.Action("LoadOwnedInventories", "User")"
                },
                "columns": [
                    { "data": "name", "render": function(data, type, row) {
                        return `<a href="/Inventory/${row.id}">${escapeHtml(data)}</a>`;
                    }},
                    { "data": "createdAt", "render": function(data) {
                        return new Date(data).toLocaleString();
                    }},
                    { "data": "itemCount" },
                    { "data": "isPublic", "render": function(data) {
                        return data ? "Public Write" : "Private";
                    }}
                ],
                "order": [[1, "desc"]]
            });

            $('#sharedInventoriesTable').DataTable({
                ...commonDataTablesOptions,
                "ajax": {
                    ...commonDataTablesOptions.ajax,
                    "url": "@Url.Action("LoadSharedInventories", "User")"
                },
                "columns": [
                    { "data": "name", "render": function(data, type, row) {
                        return `<a href="/Inventory/${row.id}">${escapeHtml(data)}</a>`;
                    }},
                    { "data": "createdAt", "render": function(data) {
                        return new Date(data).toLocaleString();
                    }},
                    { "data": "itemCount" },
                    { "data": "ownerEmail" }
                ],
                "order": [[1, "desc"]],
                "language": {
                    "emptyTable": "No inventories have been shared with you yet."
                }
            });
        });
    </script>
}